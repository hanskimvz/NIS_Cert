
# 视频信息处理设备产品系列国家安全要求
## IP摄像机安全要求 V3.0 (34章)(2024.04.03)
- 来源: 视频信息处理设备产品系列.pdf



---

# 第1节. 一般事项

## 1.1 运营环境定义
**假设条件**
- 产品的授权管理员定期对设备固件及设备内使用的软件进行最新补丁更新。
- 产品的授权管理员可通过网页浏览器等方式连接产品，此时使用<u>HTTPS、TLS、SSH</u>等通信方式执行加密通信协议。
- 产品不支持本地控制台形式的连接，初始及运营的基本连接方式为网页浏览器。

**产品概述**
- IP摄像机是可以拍摄人或物体视频等，并可选择性地获取音频，通过IP网络传输视频和音频的硬件一体化设备。
- 传输的数据为视频（图像或视频），可根据管理员的选择包含音频。
- 产品可以压缩图像传感器获取的视频和麦克风获取的音频，并通过IP网络传输，为此包含媒体服务器和用于控制管理的Web服务器。
- IP摄像机管理连接时应能够进行视频监控，IP摄像机从内置服务器发送视频。
- IP摄像机与视频信息管理存储产品之间的互联可使用<附表1>中示例的视频传输相关标准协议。

**运营环境**
- 视频信息处理设备运营的网络原则上应与互联网及业务行政网分离，配置独立网络，如因安装在远程等地无法配置独立网络，则应在VPN等加密通信环境中运营。
- 可单独运营产品管理终端（PC），在管理终端可通过网页浏览器连接等方式进行管理活动。
- IP摄像机可根据联动的视频信息管理存储产品的请求提供数据（视频或音频）。
- 产品可在运营环境中包含用于外部存储及管理运营中产生的日志的日志服务器、用于时间同步的NTP服务器。
- 此外，根据产品不同，如有功能使用所需的外部实体，可额外在运营环境中提出。
- 产品的初始管理员账户密码设置及变更尚未进行的状态定义为"默认(default)状态"，初始管理员账户密码设置及变更完成的状态定义为"运营状态"。
- 产品的识别及认证对象用户为管理员，仅获取产品提供视频的视频监控管理员也包含在识别及认证对象中。

**运营环境要求**
- 产品的授权管理员必须准确履行以下指南及指南中赋予的义务。

<table align="center">
  <tr><th>领域</th><th>名称</th><th>主管机构</th></tr>
  <tr><td rowspan="3">公共</td>
      <td>国家信息安全基本指南</td><td rowspan="2">国家情报院</td></tr>
  <tr><td>国家公共机构视频信息处理设备引进运营指南</td></tr>
  <tr><td>公共机构固定式视频信息处理设备安装运营指南</td><td>个人信息保护委员会</td>
  </tr>
  <tr><td rowspan="2">国防</td><td>国防安全业务训令</td><td rowspan="2">国防部</td></tr>
  <tr><td>国防信息安全系统业务训令</td></tr>
</table>

- 产品的授权用户应无恶意地按照引进目的运营产品。
- 产品的授权用户不应使用产品提供的存储功能以外的方式存储视频。
- 产品的授权管理员应定期检查审计数据存储空间的剩余空间以防审计记录丢失，并进行审计记录备份（外部日志服务器、单独存储设备等）等操作以防审计记录耗尽。
- 产品的授权管理员应删除产品运行不必要的操作系统服务或手段等，并通过漏洞改进工作保证操作系统的可靠性和安全性。
- 产品的授权管理员应在网络配置、变更、服务增减等导致内部网络环境变化时，立即将变化的环境和安全策略反映到产品运营策略中，以维持与之前相同水平的安全。
- 即使存储媒体（SD卡、USB存储器等）连接到外部接口，产品也应无法识别。

**通用安全要求的适用**
- 不适用通用安全要求。

---

# 第2节. 安全要求
## 2.1 视频安全
产品应提供视频信息存储、传输等的安全功能

### 2.1.1 视频协议认证
#### 2.1.1.1 <font color="red">(必须)</font> 设备间互联及视频相关标准协议(<u>ONVIF、RTSP</u>等)应提供用户认证功能
***要求项目***  
  ① 在ONVIF、RTSP等中使用Digest认证时，应遵守RFC 7616标准。  
  ② 用户认证中的加密算法应使用安全强度为112bit以上的标准算法。

### 2.1.2 视频传输安全
#### 2.1.2.1 <font color="red">(必须)</font> 设备间互联及视频传输相关标准协议通信时，应使用加密通信通道传输以保护传输数据。
***要求项目***  
① 加密通信应使用标准协议(ONVIF、RTSP等)提供机密性和完整性。  
  - 加密通信协议包括HTTPS(使用TLS实现)、TLS(TLS 1.2- RFC5246以上)、SSH(SSH V2-RFC 4251、4254)等。

② 不允许使用自定义协议。  
③ 使用的加密算法、密钥安全性及密钥存储方式应满足"9. 加密支持"要求。  
④ 可使用HTTPS隧道(RTP/RTSP/HTTPS/TCP)传输方式。

***检查注意事项***  
① 应使用数据包监控工具确认是否对传输数据提供机密性、完整性。

### 2.1.3 视频存储安全
#### 2.1.3.1 <font color="orange">(条件必须)</font> 视频存储时应提供加密存储功能。
**条件:** 支持视频存储功能时  

***要求项目***  
① IP摄像机将视频、图像等视频存储在产品内部存储时，应使用验证过的加密模块(KCMVP)加密存储。  
② 产品向视频信息管理存储产品以外的外部IT实体以文件形式提供视频信息时，应加密文件后提供。  
③ 存储的视频流中所有I帧必须加密，其他数据可根据开发商的选择进行加密。  
④ 使用的加密算法、密钥安全性及密钥存储方式应满足"9. 加密支持"要求。  
⑤ 如提供将产品内部存储的视频部分以文件形式备份到产品外部的功能，应提供加密及完整性验证功能。

***检查注意事项***  
① 如产品不支持视频存储功能，判定为"不适用"。  
② 存储在易失性内存中不视为视频存储。

#### 2.1.3.2 <font color="orange">(条件必须)</font> 应提供摄像机音频录制开关功能。
**条件:** 支持音频录制功能时

***要求项目***  
① 在默认(default)状态下，音频录制功能应可选择"开"和"关"，初始值应设置为"关"。

***检查注意事项***  
① 确认音频录制功能是否可选择"开"和"关"。  
② 分别选择"开"和"关"，确认音频录制功能的启用禁用是否正常工作。  
③ 确认初始值是否设置为"关"。  
④ 如产品不支持音频录制功能，判定为"不适用"。

### 2.1.4 视频管理安全
#### 2.1.4.1 <font color="orange">(条件必须)</font> 产品应仅在默认(default)状态下允许通过管理工具进行初始设置。
**条件:** 产品需要通过管理工具进行初始设置时

***要求项目***   
① 管理工具的功能仅允许设备搜索和IP地址设置功能。  
② 从默认(default)状态转换为运营状态后，用于管理工具设置的端口和服务应立即禁用。
 
***参考事项***   
① 如产品通过设置初始化变为默认(default)状态，可再次允许通过管理工具进行设置。

***检查注意事项***  
① 如产品没有通过管理工具的搜索设置功能，判定为"不适用"。

## 2.2 识别及认证
确认产品对管理员、普通用户、外部IT实体、视频协议的识别及认证功能。
### 2.2.1 用户等识别及认证
#### 2.2.1.1 <font color="red">(必须)</font> 产品应提供基于用户账户密码的识别及认证功能以验证用户身份。
***要求项目***   
① 必须执行识别及认证以确认用户是产品的合法用户。  
① 管理员应能为每个用户或组分配权限。  
③ 用户账户(ID)应注册为唯一值，不得重复。  

***检查注意事项***  
① 应确认产品提供的全部用户角色。  
- 对于管理员，应确认是否按管理连接等连接路径要求识别及认证。
- 如存在普通用户，应确认访问产品时是否要求识别及认证。

② 应确认访问管理服务时是否要求识别及认证。  
③ 应确认访问视频相关功能（实时视频监控、播放（搜索）、在产品外部存储视频等）时是否要求识别及认证。  
④ 应确认管理员是否能为每个用户或组设置权限。   
⑤ 应确认是否存在已知漏洞。  
- 需确认是否限制账户及密码输入字段可输入的字符串。
- 试验机构可在收到"漏洞改进明细书"审查后省略漏洞性试验。

⑥ 试验机构应确认漏洞检查工具使用的适当性后用于试验。  
⑦ 应确认是否能绕过用户认证访问管理界面

#### 2.2.1.2 <font color="orange">(条件必须)</font> 产品应认证联动的外部IT实体。
 **条件:** 产品需要认证外部IT实体时

***参考事项***  
① <u>视频信息管理存储产品联动密码、SNMP认证密码、SNMP加密密码</u>等可成为适用对象。

***检查注意事项***  
① 试验员应调查产品与外部IT实体联动时产品需要认证的所有外部IT实体。  
② 如产品没有需要认证的外部IT实体，判定为"不适用"。




### 2.2.2 认证失败响应
#### 2.2.2.1 <font color="red">(必须)</font> 产品中用户认证连续失败达到设定次数时，识别及认证功能应被禁用。
***要求项目***  
① 识别及认证功能禁用后启用的方法示例包括：账户锁定后经过指定时间后启用、账户锁定后提供其他识别及认证手段以启用等。  
② 导致识别及认证禁用的连续认证失败次数应固定为5次以下的值或可设置为5次以下的值。  
③ 如实现为一定时间内禁用认证功能，重新启用前所需时间应固定为5分钟以上的值或可设置。

***检查注意事项***  
① 应通过提交文件确认是否有限制使用错误认证信息反复尝试认证的方法。  
② 试验员应确认支持管理员认证的所有服务（SSH、HTTPS、SFTP、ONVIF、RTSP等）是否满足要求。  
③ 应确认除被禁用账户外的其他管理员账户认证成功时，被锁定账户的锁定是否不会解除。  
④ 应确认将管理员连接PC的时间更改为识别及认证禁用前的时间后尝试认证时，禁用功能是否正常工作。  
⑤ 次数（5次）或期间（5分钟）应固定为默认值或可设置。


#### 2.2.2.2 <font color="red">(必须)</font> 产品中管理员认证连续失败达到设定次数时，应通过管理员可立即确认的手段进行通知。
***要求项目***  
① 应通过警报、短信、电子邮件等中的一种以上手段进行通知。

***检查注意事项***  
① 试验员应确认支持管理员认证的所有服务（SSH、HTTPS、SFTP、ONVIF、RTSP等）是否满足要求。



### 2.2.3 密码等敏感信息生成及安全性验证
#### 2.2.3.1 <font color="red">(必须)</font> 产品在注册及变更密码时应满足<表1>的安全性标准。
***要求项目***  
<table align="center">
<tr> <th colspan="4">< 表1. 密码安全性标准类型(1)></th></tr>
<tr><th>类别</th><th>项目</th><th>要求</th><th>备注</th></tr>
<tr><td rowspan="6">遵守事项</td><td>最小长度</td><td><b>9位以上</b></td><td>必须</td></tr>
<tr><td>包含大写字母</td><td>包含1个以上英文大写字母</td><td>A-Z</td></tr>
<tr><td>包含小写字母</td><td>包含1个以上英文小写字母</td><td>a-z</td></tr>
<tr><td>包含数字</td><td>包含1个以上数字</td><td>0-9</td></tr>
<tr><td>包含特殊字符</td><td>包含1个以上特殊字符</td><td>!@#$%^&*()等</td></tr>
<tr><td>复杂度</td><td>混合使用以上4种类型</td><td>必须</td></tr>
<tr><td rowspan="5">禁止事项</td><td>禁止包含ID</td><td>禁止密码中包含与用户ID相同的字符串</td><td>如ID为<code>admin</code>则禁止<code>admin123!</code></td></tr>
<tr><td>相同字符连续</td><td>禁止连续使用相同字符或数字</td><td>禁止<code>aaa</code>、<code>111</code>、<code>!!!</code></td></tr>
<tr><td>顺序字符</td><td>禁止键盘连续字符顺序排列</td><td>禁止<code>qwerty</code>、<code>asdf</code>、<code>1234</code></td></tr>
<tr><td>顺序数字</td><td>禁止连续数字顺序排列</td><td>禁止<code>123456</code>、<code>987654</code></td></tr>
<tr><td>之前的密码</td><td>禁止重复使用上次使用的密码</td><td>至少管理1次历史记录</td></tr>
</table>


```
密码有效性检查:
├── ✅ 长度 >= 9位
├── ✅ 包含大写字母 (A-Z)
├── ✅ 包含小写字母 (a-z)
├── ✅ 包含数字 (0-9)
├── ✅ 包含特殊字符
├── ❌ 不包含ID字符串
├── ❌ 相同字符/数字不能连续3次以上 (如: aaa, 111)
├── ❌ 键盘顺序字符不能连续3个以上 (如: qwe, asd)
├── ❌ 顺序数字不能连续3个以上 (如: 123, 987)
└── ❌ 不能与上次密码相同
```
***检查注意事项***   
① 如选择实现"禁止重复使用3个月内使用过的密码"功能，重复使用禁止期间应在3个月内固定或可变设置。  
② "键盘上连续或顺序输入"视为的字符数字输入如下：
- △'q'、'w'、'e'、'r' △'a'、's'、'd'、'f' △'1'、'2'、'3'、'4'等左右连续的字符或数字输入4个以上的情况。（特殊字符除外。）


#### 2.2.3.2 <font color="orange">(条件必须)</font> 产品应提供设置外部IT实体认证所需信息的功能。
**条件:** 需要设置外部IT实体认证所需的认证信息时

***要求项目***  
① 适用对象可以是视频信息管理存储产品联动密码、SNMP认证加密密码等。  
② 如外部IT实体认证使用密码，应遵守△2.3.1的安全性标准。
 
***参考事项***  
① 用于外部IT实体认证功能的密码，即使是安全性标准中包含的字符，如外部IT实体不允许输入，也可不包含。

***检查注意事项***  
① 试验员应调查产品与外部IT实体联动时产品需要认证的所有外部IT实体，并确认是否提供设置认证所需认证信息的界面。  
② 试验员应确认用于认证外部IT实体的认证信息如存储在产品控制的存储中，是否按照"4.2 存储数据保护"要求存储。  
③ 如产品没有需要认证的外部IT实体，判定为"不适用"。


### 2.2.4 认证信息重用防止
#### 2.2.4.1 <font color="red">(必须)</font> 产品应防止用户认证信息的重用。
***要求项目***  
① 必须适用于△1.1.1和△2.1.1规定的识别及认证中使用的认证信息。  
② 可通过加密会话ID或保证会话ID唯一性(<u>时间戳、会话过期时间设置等</u>)来防止。  
③ 如产品检测到禁止重用的认证信息的重用尝试，认证应失败并应生成认证失败事件的审计记录。  

***参考事项***  
① 如产品仅接收外部IT实体的额外识别及认证执行结果，则假定该认证信息的重用防止由外部IT实体提供。  
② 会话过期时间应考虑提供服务的特性设置为可最小化的值。

***检查注意事项***  
① 应确认用户不退出登录时使用之前使用的认证信息（会话ID、Cookie等）更改后再次登录时是否失败。  
② 应确认用户退出登录后使用之前使用的认证信息（会话ID、Cookie等）更改后重新登录时是否失败。  
③ 应确认用户登录时用户密码是否以加密状态传输。



### 2.2.5 认证反馈保护
#### 2.2.5.1 <font color="red">(必须)</font> 产品在输出设备上显示认证中使用的信息时，不应显示内容。
***要求项目***  
① 适用于△1.1.1 △2.1.1 △2.3.1规定的认证信息在输出设备上显示的情况。  
② 认证中使用的信息应以不显示输入内容、用"✽"代替输入字符等形式输出。  
③ 用户登录时认证信息不应以明文暴露在内存区域。

***检查注意事项***  
① 试验员应调查产品需要认证信息输入的安全功能。  
② 不仅是用户登录时，还应识别新用户账户创建、密码变更等输入认证信息的所有功能，并确认是否满足要求。  
③ 试验员应确认支持用户认证的所有服务(<u>SSH、HTTPS、SFTP、ONVIF、RTSP等</u>)是否满足要求


#### 2.2.5.2 <font color="red">(必须)</font> 产品在识别及认证失败时，不应提供失败原因的反馈(<u>不存在的账户(ID)、密码错误等</u>)。
***检查注意事项***  
① 输入错误认证信息导致认证失败后，应确认告警消息中是否提供可推测认证失败原因的反馈

## 2.3 安全管理
只允许授权管理员对产品的安全功能及重要数据进行管理，确认是否满足产品安全管理要求。
### 2.3.1 安全管理功能
#### 2.3.1.1 <font color="red">(必须)</font> 产品应为授权管理员提供可设置及管理安全功能、安全策略、重要数据等的安全管理功能。
***要求项目***  
① 属于安全管理功能的事项如下：  
  * 可添加、删除、变更决定安全功能运行的条件或规则的功能。  
  * 根据条件或规则添加、删除、变更产品应执行的行为的功能。  
  * 选择、变更产品设置的功能。  
  * 设置、变更摄像机控制的功能。  

② 产品应实现的安全管理功能如下<表2>所示。

<table align="center">
<tr><th colspan="3">< 表2. 产品应实现的安全管理功能 ></th></tr>
  <tr><th>小类</th><th>安全管理</th><th>备注</th></tr>
  <tr><td rowspan="6">识别及认证</td>
    <td>用户的注册、删除、修改、权限授予</td>
    <td>如产品注册用户唯一则不适用</td></tr>
  <tr><td>用户密码组合长度策略设置</td>
    <td>提供功能时必须</td></tr>
  <tr><td>用户认证失败允许次数设置</td>
    <td>提供功能时必须</td></tr>
  <tr><td>用户认证失败响应方法设置</td>
    <td>提供功能时必须</td></tr>
  <tr><td>用户认证功能禁用后到启用的时间设置</td>
    <td>提供功能时必须</td></tr>
  <tr><td>产品认证的外部IT实体认证信息设置</td>
    <td>提供功能时必须</td></tr>
  <tr><td rowspan="6">安全管理</td>
    <td>管理用终端的IP注册、删除、修改</td>
    <td></td></tr>
  <tr><td>重要数据、设置信息、审计记录等的备份</td>
    <td>提供功能时必须</td></tr>
  <tr><td>重要数据、设置信息、审计记录等的恢复</td>
    <td>提供功能时必须</td></tr>
  <tr><td>管理连接服务启用、禁用</td>
    <td>提供功能时必须</td></tr>
  <tr><td>访问外部IT实体的认证信息设置</td>
    <td>提供功能时必须</td></tr>
  <tr><td>摄像机控制(PTZ等)设置及操作设置初始化</td>
    <td>提供功能时必须</td></tr>
  <tr><td rowspan="4">自我保护</td>
    <td>管理员请求下的产品安全功能自测执行</td>
    <td>提供功能时必须</td></tr>
  <tr><td>自测失败时响应行为设置</td>
    <td>提供功能时必须</td></tr>
  <tr><td>管理员请求下的产品设置值及产品自身完整性检查执行</td>
    <td></td></tr>
  <tr><td>完整性检查失败时响应行为设置</td>
    <td>提供功能时必须</td></tr>
  <tr><td rowspan="3">更新保护</td>
    <td>管理员手动验证更新文件有效性</td>
    <td>提供功能时必须</td></tr>
  <tr><td>管理员手动恢复更新文件安装失败</td>
    <td>提供功能时必须</td></tr>
  <tr><td>产品版本信息查询</td>
    <td></td></tr>
  <tr><td rowspan="3">会话管理</td>
    <td>用户会话锁定、结束时间设置</td>
    <td>提供功能时必须</td></tr>
  <tr><td>(会话锁定情况)会话解锁时管理员或个人用户认证</td>
    <td></td></tr>
  <tr><td>用户同时连接会话数设置</td>
    <td>提供功能时必须</td></tr>
  <tr><td rowspan="2">审计记录</td>
    <td>审计记录查询</td>
    <td></td></tr>
  <tr><td>审计记录丢失响应相关设置</td>
    <td>提供功能时必须</td></tr>  
</table>

***检查注意事项***  
① 试验员应识别产品提供的所有安全管理功能。
- 试验员应确认产品提供的所有安全管理功能是否在《安全功能实现规范》或《安全功能运营说明书》中描述。
- 试验员应确认所有安全管理功能是否满足要求。

② 应确认安全管理功能是否只有授权管理员可以执行。  
③ 应确认是否对输入值进行验证(<u>不允许的字符、长度限制等</u>)。  


### 2.3.2.1 管理连接功能
#### 2.3.2.1 <font color="red">(必须)</font> 产品应为所有管理连接提供启用禁用功能。
***检查注意事项***  
① 试验员应调查产品支持的所有管理连接。  
② 产品的基本连接方式网页浏览器(HTTPS)连接在默认(default)状态下允许启用，所有其他管理连接在默认(default)状态下应被禁用。但如产品需要通过管理工具进行初始设置，可额外允许按照△1.4.1要求的管理工具连接启用。  
③ 应从产品外部执行端口扫描，确认是否存在不必要的端口。  
④ 应限制从外部远程直接访问产品内运营的DBMS。  
⑤ 对于提供外部可访问API的设备，试验员应确认该服务是否有启用禁用功能。  
⑥ 试验员应确认产品的管理连接是否只使用加密通信。


### 2.3.3 安全管理用IP限制
#### 2.3.3.1 <font color="red">(必须)</font> 产品应提供限制可连接的管理用终端IP的功能。
***要求项目***  
① 应能注册、删除、修改管理用终端IP地址。  
② 只具有读取权限而非管理用途的管理员(<u>视频监控管理员等</u>)可连接的管理用终端可额外注册运营。  
③ 可连接的管理用终端IP只能以单一主机单位逐个添加。  
④ 不允许指定IP地址范围添加的方式，如192.168.10.2~253等，或使用表示整个网络范围的0.0.0.0、192.168.10.*、any等进行注册。  
⑤ 从默认(default)状态转换为运营状态前，应有注册可连接的管理用终端IP的过程。

***检查注意事项***  
① 应确认IP注册时是否可按单一IP注册。  
② 应确认是否不允许指定IP地址范围添加的方式。  
③ 只具有读取权限而非管理用途的管理员(视频监控管理员等)可连接的PC可额外注册。



### 2.3.4 默认提供的账户及密码等管理
#### 2.3.4.1 <font color="red">(必须)</font> 产品在初次产品连接(<u>网页浏览器连接等</u>)时应提供强制变更使用中止默认提供账户的功能。
***要求项目***  
① 初次连接时，应在屏幕上显示默认提供的账户。  
② 默认提供的账户在初次连接时应强制变更或使用中止(Disable)。  
③ 如没有默认提供的账户，应创建新账户，之后应能管理连接产品。  
④ 变更账户或新创建时，不应允许可推测的名称(root、admin、厂商名、摄像机型号等)。

***检查注意事项***  
① 试验员应调查产品支持的所有管理连接(SSH、HTTPS、ONVIF、RTSP等)。  
② 应确认产品的所有功能是否只在提供账户的变更使用中止或创建进行后才能运行。  
③ 试验员应确认是否有未在屏幕显示的账户。  
④ 试验员如额外识别出未在屏幕显示的账户，应在试验结果报告书中将该账户记录为后门，并判定为"不满足"。  


#### 2.3.4.2 <font color="red">(必须)</font> 产品在初次产品连接(<u>网页浏览器连接等</u>)时应提供强制变更生成管理员默认(default)密码的功能。
***要求项目***  
① 如存在默认(default)密码，在初次产品连接时应提供变更默认(default)密码的功能，之后应能管理连接产品。  
② 如没有默认(default)密码，应生成新密码，之后应能管理连接产品。
- 密码应遵守2.3.1的安全性标准。

***检查注意事项***  
① 试验员应调查产品支持的所有管理连接(<u>SSH、HTTPS、ONVIF、RTSP等</u>)。  
② 应确认产品的所有功能是否只在默认(default)密码变更或生成进行后才能运行。

#### 2.3.4.3 <font color="orange">(条件必须)</font> 产品应提供变更访问内部组件或外部IT实体使用的默认(default)密码的功能。
**条件:** 为访问产品内部组件或外部IT实体需要密码的功能提供时

***要求项目***  
① 默认(default)密码的示例包括<u>DBMS密码、Web服务器WAS服务器密码等</u>。  
② 如产品存储访问DBMS的默认(default)密码，产品应提供变更默认(default)密码的功能。  
③ 如产品存储访问Web服务器WAS服务器的默认(default)密码，应提供变更默认(default)密码的功能。  
④ 生成密码时根据是否并行额外识别及认证功能，应遵守2.3.1的安全性标准。  
⑤ 如产品中存在访问DBMS·Web服务器·WAS服务器的默认(default)账户(ID)，可提供变更该账户的功能。

***参考事项***  
① 产品内可包含DBMS·Web服务器·WAS服务器等，也可与产品外部单独存在的DBMS·Web服务器·WAS服务器等联动。  
② 即使是密码安全性标准中包含的字符，如联动的外部IT实体不允许输入，也可不包含。

***检查注意事项***  
① 试验员应调查产品内存在或与产品联动的需要其他认证信息的认证服务器、DBMS·Web服务器·WAS服务器等。  
② 试验员应确认如认证信息为密码，是否满足2.3.1的安全性标准。  
③ 可选择实现变更DBMS·Web服务器·WAS服务器管理员默认(default)账户(ID)的功能。  
④ 如产品没有访问内部组件或外部IT实体的功能，判定为"不适用"。

#### 2.3.4.4 <font color="orange">(条件必须)</font> 产品应提供设置从外部IT实体获得认证所需认证信息的功能。
**条件:** 与产品联动的外部IT实体要求认证信息以认证产品时

***要求项目***  
① 认证信息的示例包括SMTP服务器认证产品使用的密码等。  
② 建议密码遵守"服务器通用安全要求1.3.2"规定的安全性标准。
  - 但即使是密码安全性标准中包含的字符，如联动的外部IT实体不允许输入，也可不包含。

***检查注意事项***  
① 试验员应调查与产品联动时在认证产品后允许访问的SMTP服务器等。  
② 试验员应调查产品与外部IT实体联动时外部IT实体认证产品的所有情况，并确认是否提供设置认证信息的界面。  
③ 试验员应确认如认证信息为密码，是否满足"服务器通用安全要求1.3.2"的安全性标准。  
④ 如产品没有从外部IT实体获得认证的功能，判定为"不适用"。




## 2.4. 数据保护
确认产品是否支持加密通信以保护用户或外部IT实体通信间传输的数据免受泄露变更。产品应保护存储在存储中的安全功能相关数据免受未授权泄露。

### 2.4.1 传输数据保护
#### 2.4.1.1 <font color="red">(必须)</font> 产品在管理连接时应使用加密通信通道传输以保护传输数据。
***要求项目***  
① 加密通信应使用标准协议提供机密性和完整性。
  - 加密通信协议包括HTTPS(使用TLS实现)、TLS(TLS 1.2- RFC5246以上)、SSH(SSH V2-RFC 4251、4254)等。

② 不允许使用自定义协议。  
③ 加密通信通道可直接在产品中实现，或可实现为产品利用运营环境提供。  
④ 使用的加密算法、密钥安全性及密钥存储方式应满足"9. 加密支持"要求。

***参考事项***  
① 产品的默认(default)状态下与管理工具的通信可不适用此要求。

***检查注意事项***  
① 应使用数据包监控工具确认是否对传输数据提供机密性、完整性。  
② 试验员为试验按要求的准确实现，必要时可直接与开发者面对面要求说明实现内容。  


#### 2.4.1.2 <font color="orange">(条件必须)</font> 产品与外部IT实体联动时应使用加密通信通道传输以保护传输数据。
**条件:** 支持与外部IT实体联动时

***要求项目***  
① 加密通信应使用标准协议提供机密性和完整性。  
- 加密通信协议包括HTTPS(使用TLS实现)、TLS(TLS 1.2-RFC5246以上)、SSH(SSH V2-RFC 4251、4254)等。

② 不允许使用自定义协议。  
③ 加密通信通道可直接在产品中实现，或可实现为产品利用运营环境提供。  
④ 如产品为提供安全功能与外部IT实体联动提供功能，应适用此要求。  
⑤ 与外部IT实体联动时如不使用加密通信通道保护传输数据，应证明传输数据机密性、完整性保护的不必要性。  
⑥ 应能禁用不支持加密通信通道的通信服务。  
⑦ 使用的加密算法、密钥安全性及密钥存储方式应满足"9. 加密支持"要求。

***参考事项***  
① 外部IT实体包括认证服务器、SNMP服务器、更新服务器、日志服务器等，与引进机构允许的NTP服务器等的明文通信可不适用此要求。

***检查注意事项***  
① 如产品为提供安全功能与外部IT实体联动提供支持，应适用此要求进行试验。  
② 但对于外部IT实体中与NTP服务器的通信，不适用此要求。  
③ 如支持syslog，应通过<u>syslog over TLS(RFC 5424)、syslog over DTLS(RFC6012)等</u>支持加密传输。  
④ 如产品没有与外部IT实体联动的功能，判定为"不适用"。



### 2.4.2 存储数据保护
#### 2.4.2.1 <font color="red">(必须)</font> 在产品内部存储重要信息时应按规定方式存储。
***要求项目***  
① 产品存储至少以下重要信息时应加密存储。
  - 产品用于用户识别及认证使用的密码。
  - 用于产品额外识别及认证使用的认证信息。
  - 数据加密密钥(DEK: Data Encryption Key)

② 数据加密密钥(DEK)应使用密钥加密密钥(KEK : Key Encryption Key)加密存储。  
③ 密钥加密密钥(KEK)生成及存储等相关要求应满足"9.2 密钥生成"及"9.3 密钥存储"要求。  
④ 产品存储以下信息时应以<u>加密、访问控制等</u>方式存储。
  - 产品与外部IT实体联动时相互认证使用的信息。
  - 产品访问产品内部或外部存在的DBMS·Web服务器·WAS服务器所需的DBMS·Web服务器·WAS服务器管理员密码。
  - 密钥。(预共享密钥、对称密钥、私钥)
  - 包含组织重要信息的检测规则、签名等。

⑤ 产品用于用户识别认证使用的用户密码应使用单向加密(哈希)或双向加密存储。
  - 执行单向加密时需要在密码中添加称为salt的随机生成值后适用。
  - salt值无需保密，使用随机数生成器生成，大小应至少48bit以上。
  - iteration count应尽可能适用大值。(至少1000次以上)

⑥ 产品运营所需的DBMS·Web服务器·WAS服务器管理员密码等可应用公钥·对称密钥加密算法加密存储。  
⑦ 密钥指预共享密钥、对称密钥、私钥等，产品管理连接本地连接、产品组件间联动设置使用的密钥都是对象。  
⑧ 应加密存储的最少重要信息中包含的密码及密钥不能硬编码在产品中存储。  
⑨ 申请厂商应提交产品支持的存储数据保护方法的详细说明资料(《安全功能实现规范》)证明安全性。  
⑩ 使用的加密算法、密钥安全性及密钥存储方式应满足"9. 加密支持"要求。  
⑪ 建议使用验证过的加密模块(KCMVP)。

***参考事项***  
① 如运营产品的组织的重要信息包含在综合安全管理、入侵防御系统产品的检测规则、签名等中，应以保护免受泄露的方式存储。  
② 所有存储的重要信息应无法读取或推测。  
③ 随机数生成器应按照"9. 加密支持"要求遵守国内外标准实现。

***检查注意事项***  
① 应确认输入相同密码时是否不生成存储相同密文。  
② 如单向加密密码，应确认是否按标准生成存储值。  
③ 如加密存储密码，应确认是否按"9. 加密支持"要求存储密钥。  
④ 应确认是否按"9. 加密支持"要求使用随机数生成器。  
⑤ 应确认DB连接密码、自动登录所需密码、密钥加密密钥等是否未硬编码在产品中。




#### 2.4.2.2 <font color="red">(必须)</font> 产品应提供保护存储的产品设置值(<u>安全策略、环境设置参数等</u>)只有授权管理员可访问的功能。
***要求项目***  
① 产品应提供只有授权管理员可访问产品设置值的界面，除授权管理员外不能访问产品设置值。
  - 访问指读取、变更、删除等操作。

② 如提供将产品设置值以文件形式备份到外部的功能，应提供加密功能。
③ 加密时使用的加密算法、密钥安全性及密钥存储方式应满足"9. 加密支持"要求。

***参考事项***  
① 产品设置值可以文件形式存储在联动的运营环境DBMS中。  
② 如无法完全用产品安全功能实现，可支持在运营环境中保护产品设置值存储。  
- 如产品设置值存储在联动的运营环境DBMS中，可利用DBMS的识别及认证功能保护免受未授权用户访问。

***检查注意事项***  
① 如在内部存储产品设置值时提供加密保护功能，也可判定要求"满足"。  
② 使用的加密算法、密钥安全性及密钥存储方式应满足"9. 加密支持"要求。




## 2.5. 自我保护
产品为保证安全功能正常运行，应能定期或按管理员请求执行自测。应确认安全功能机制及数据的完整性以保护产品的安全功能。
### 2.5.1 安全功能自测
#### 2.5.1.1 <span style="color:red">(必须)</span> 产品应在启动(或执行)运营中定期或按管理员请求执行自测。
***要求项目***  
① 产品启动(或执行)时必须执行自测，运营中应支持定期或按管理员请求执行。  
② 自测对象指产品的主要进程，应确认进程是否正常执行。  
③ 自测对象由申请厂商可选择，但如作为试验对象的实体的异常状态(错误、停止等)影响产品安全功能，该实体必须包含在自测对象中。  
④ 自测执行历史应能通过屏幕输出、审计记录确认。  
⑤ 产品启动时及运营中应执行可检测产品范围包含的硬件(内存、闪存、NIC等)及软件(进程等)错误的自测。  
⑥ 申请机构应在提交文件中详细描述自测功能。

***检查注意事项***  
① 硬件操作系统包含在产品范围内。  
② 试验员应确认提交物中是否详细描述了自测。



#### 2.5.1.2 <font color="red">(必须)</font> 产品的自测结果为失败时应执行响应功能。
***要求项目***  
① 产品应执行为保证准确运行实现的响应功能或管理员设置的响应功能。  
② 应生成自测结果的审计记录。  
③ 自测结果失败时执行的响应功能示例包括<u>程序执行中断、警告消息屏幕输出、进程重新启动等</u>。  
④ 可提供让管理员设置响应功能的安全管理功能。

***检查注意事项***  
① 应确认产品△首次执行(或启动)时 △管理员手动请求时自测失败的所有情况。  
② 如有响应功能的管理员设置功能，应按"3.1 安全管理功能"要求进行试验。  




### 2.5.2 完整性验证
#### 2.5.2.1 <font color="red">(必须)</font> 产品应提供验证自身及设置值完整性的功能。
***要求项目***  
① 完整性验证对象为产品的设置值(<u>环境设置文件等</u>)及产品自身(<u>进程、库、执行文件等</u>)。  
② 产品首次执行时(或启动时)应执行完整性验证，附加可执行定期完整性验证。  
③ 完整性验证对象由申请厂商可选择，但如作为验证对象的实体的异常状态(错误、停止等)影响产品安全功能，该实体必须包含在完整性验证对象中。  
④ 应提供管理员执行完整性验证的功能。  
⑤ 申请厂商应提交产品支持的完整性验证功能的详细说明资料(《安全功能实现规范》)。  
⑥ 使用的加密算法、密钥安全性及密钥存储方式应满足"9. 加密支持"要求。

***检查注意事项***  
① 试验员应调查产品的完整性验证对象及机制。  
② 应确认产品自动执行完整性验证的周期是否可固定或设置为1天以内的值。  
③ 以哈希值比较方法执行完整性检查功能时，如原始哈希值以文件系统存储的形式，应确认原始哈希值是否受保护。  
④ 试验员应确认产品完整性验证的数据存储时是否按"4.2 存储数据保护"要求存储



#### 2.5.2.2 <font color="red">(必须)</font> 产品应提供验证操作系统内核或内核级模块完整性的功能。
***要求项目***  
① 以哈希值比较方法验证完整性时，使用的加密算法、密钥安全性及密钥存储方式应满足"9. 加密支持"要求。

#### 2.5.2.3 <font color="red">(必须)</font> 产品应提供让管理员确认完整性验证内容及结果的功能。
***要求项目***  
① 完整性验证内容及结果应能通过屏幕输出、审计记录确认。

***检查注意事项***  
① 如完整性检查执行周期很短，可能产生多次完整性检查成功的审计记录，因此可对一定时间内发生的完整性检查成功生成1次审计记录，并在审计记录中添加生成完整性检查成功次数。

#### 2.5.2.4 <font color="red">(必须)</font> 产品在完整性验证失败时应执行响应功能。
***要求项目***  
① 产品应执行自身实现的响应功能或管理员设置的响应功能。  
② 应生成完整性验证结果的审计记录。  
③ 完整性验证结果失败时执行的响应功能示例包括<u>程序执行中断、警告消息屏幕输出</u>等。  
④ 可提供让管理员设置响应功能的安全管理功能。

***检查注意事项***  
① 应确认产品△首次执行时(或启动时) △管理员手动请求时 △定期执行时完整性验证失败的所有情况。  
② 如没有响应功能的管理员设置功能，执行产品基本设置的响应功能即判定满足要求。  
③ 如有响应功能的管理员设置功能，应按"3.1 安全管理功能"要求进行试验。

### 2.6 更新保护
产品可提供安装或应用产品安装文件、产品运营所需文件等"更新文件"的功能。产品应在安装或应用更新文件前对更新文件执行有效性验证等。

#### 2.6.1.1 <font color="red">(必须)</font> 产品在安装或应用更新文件前应验证产品更新文件的有效性。
***要求项目***  
① 产品更新时，只应安装或应用有效性验证成功的更新文件。  
② 更新文件有效性验证时完整性验证必须，应使用<u>电子签名验证、公开哈希值验证等</u>实现。
③ 电子签名验证时应执行证书有效性验证。  
④ 加密算法及密钥安全性应满足"9. 加密支持"要求。  
⑤ 更新文件有效性验证结果(成功失败)应记录在审计记录中。

***检查注意事项***  
① 更新文件的有效性验证可通过<u>电子签名验证、公开哈希值验证等</u>确认。  
② 应确认是否将更新安装执行限制为授权管理员。  
③ 不允许无有效性确认的自动更新功能。




#### 2.6.1.2 <font color="red">(必须)</font> 产品应提供让用户确认"产品唯一识别信息"的功能。
***要求项目***  
① 产品识别信息应唯一，用户应能通过界面确认且不能修改变更，应包含以下事项。
  - 产品名称、产品版本、产品发布或构建号、固件哈希值

② 如产品包含物理分离的多个组件，各组件的识别信息应唯一，用户应能确认且不能修改变更，应包含以下事项。
  - 包含组件的产品名称及版本、
  - 组件名称、组件版本、组件发布或构建号。

③ 应适用可确认产品组件补丁及功能改进与否的版本管理体系。  
(补丁及功能改进时按事案变更Major版本、Minor版本、发布号构建号的体系，以版本信息追踪产品组件变更原因)

④ 除产品识别信息外，用户应能通过产品界面确认固件的唯一识别信息及哈希值。

#### 2.6.1.3 <font color="red">(必须)</font> 产品在更新安装失败时应提供自动保持现有版本的功能。
***要求项目***  
① 应生成更新安装结果及失败原因的审计记录。  
② 如产品不支持，应支持管理员手动恢复。  
③ 开发厂商应在提交物中详细描述管理员手动恢复程序。

***检查注意事项***  
① 应确认是否将更新安装执行限制为授权管理员。  
② 如产品不支持，应确认提交物中是否明示了手动恢复程序。  
③ 也允许以设置初始化为手动恢复方法。

## 2.7 会话管理
产品在用户长时间不使用时应锁定或结束会话。此外，产品应提供同时连接会话的限制功能。

### 2.7.1 会话锁定结束功能
#### 2.7.1.1 <font color="red">(必须)</font> 产品在管理员会话连接后一定时间内不使用时，应提供锁定或结束会话的功能。
***要求项目***  
① 使用的时间信息应基于服务器时间适用。  
② 一定时间指触发会话锁定或结束行为的连接后累计时间量。
  - 一定时间管理员可固定为10分钟以下的值或根据认证失败次数比例设置。

③ 锁定的会话应在锁定时间经过后，由管理员或通过各会话的用户认证功能解除。
④ 会话锁定或结束功能运行时应生成审计记录。
⑤ 应适用于产品包含的所有管理连接。

***参考事项***  
① 应确认视频监控功能中一定时间经过并尝试转换为其他管理功能时是否要求用户认证。

***检查注意事项***  
① 应确认产品支持的所有管理连接(SSH、HTTPS等)。  
② 应确认会话解锁是否能通过管理员认证或用户认证。  
③ 应确认视频监控功能中一定时间经过并尝试转换为其他管理功能时是否要求用户认证。  



#### 2.7.1.2 <font color="red">(必须)</font> 产品不应允许使用相同管理员账户或相同权限重复连接产品。
***要求项目***  
① 用户登录后在其他终端以相同账户登录时，阻止新连接或要求结束之前的连接。
② 不应允许以相同权限重复登录。
③ 阻止重复连接时应生成审计记录。

***参考事项***   
① 为视频监控PTZ等摄像机控制目的连接的管理员账户及权限可不适用。  
② 对于可进行多会话连接的设备间联动及视频传输相关标准协议(ONVIF、RTSP等)，不适用此要求。

***检查注意事项***  
① 应确认用户账户在相同PC或其他PC同时连接时是否阻止。  
② 应确认产品支持的所有管理连接(SSH、HTTPS等)。


## 2.8 审计记录
产品应检测、记录、分析与安全功能及管理员安全活动相关的事项并支持响应。此外应确认是否提供应对审计记录删除存储失败等无效化的功能
### 2.8.1 审计记录生成
#### 2.8.1.1 <font color="red">(必须)</font> 产品应对主要审计事件生成审计记录。
***要求项目***  
① 必须生成审计记录的审计事件如下<表3>所示。

<table>
  <tr><th colspan="3">< 表3. 必须记录的主要审计事件></th></tr>
  <tr><th>小类</th><th>安全管理</th><th>附加审计信息</th></tr>
  <tr><td rowspan="4">识别及认证</td>
    <td>用户登录、退出</td><td></td></tr>
  <tr><td>用户注册、变更、删除</td><td></td></tr>
  <tr><td>用户认证尝试达到限值时响应行为</td><td></td></tr>
  <tr><td>密码的所有变更</td><td></td></tr>
  <tr><td rowspan="3">安全管理</td>
      <td>〈表2〉安全管理功能的执行和安全属性值的所有变更、删除<br>※ 但安全管理功能中"审计记录查询"及"产品版本信息查询"功能除外</td><td>变更的安全属性数据</td></tr>
  <tr><td>基本账户(ID)密码变更</td><td></td></tr>
  <tr><td>管理用终端连接IP阻止</td><td></td></tr>
  <tr><td rowspan="3">会话管理</td>
      <td>用户会话锁定或会话结束</td><td></td></tr>
  <tr><td>检测相同账户重复登录尝试时响应行为</td><td></td></tr>
  <tr><td>基于相同会话数限制的新会话拒绝</td><td></td></tr>
  <tr><td>密钥生成</td><td>密钥生成失败</td><td></td></tr>
  <tr><td>加密使用</td><td>加密运算失败(包含加密运算类型)</td><td></td></tr>
  <tr><td rowspan="2">审计记录</td>
      <td>硬件一体化产品的审计功能启动和结束</td><td></td></tr>
  <tr><td>产品时间设置变更</td><td></td></tr>
</table>

② 提供功能时应生成审计记录的审计事件如下<表4>所示。

<table>
  <tr><th colspan="3">〈表4. 提供功能时可记录的主要审计事件〉</th></tr>
  <tr><th>小类</th><th>安全管理</th><th>附加审计信息</th></tr>
  <tr><td rowspan="2">视频安全</td>
      <td>视频外部存储功能执行</td><td>哈希值</td></tr>
  <tr><td>录制设置及变更</td><td></td></tr>
  <tr><td>安全管理</td>
      <td>摄像机控制(PTZ等)设置及操作</td><td></td></tr>
  <tr><td rowspan="2">自我保护</td>
      <td>自测执行</td><td>失败的安全功能</td></tr>
  <tr><td>产品自身完整性检查执行</td><td>完整性检查失败的组件</td></tr>
  <tr><td rowspan="2">更新保护</td>
      <td>管理员手动验证更新文件有效性</td><td></td></tr>
  <tr><td>更新文件有效性验证执行</td><td></td></tr>
  <tr><td>审计记录</td>
      <td>审计记录存储失败时响应行为</td><td></td></tr>
</table>

***检查注意事项***  
① 试验员应调查产品的所有审计记录行为。  
② 产品启动时生成审计记录的情况(<u>自测结果、完整性检查等</u>)不明示"审计功能启动"也判定满足要求。  
③ 因漏洞性试验等强制结束产品时不记录"审计功能结束"也判定满足要求。

#### 2.8.1.2 <font color="red">(必须)</font> 审计记录不应包含不必要的信息。
***要求项目***  
① 记录中至少应包含的项目如下。
  - 事件发生日时、事件类型、发生事件的主体身份(账户、进程、IP等)、事件结果(成功失败)

② 不应在审计记录内存储认证信息(<u>密码等</u>)、密钥等信息。

#### 2.8.1.2 <font color="red">(必须)</font> 产品各组件应使用可信时间信息生成审计记录。
***要求项目***  
① 可信时间信息应使用NTP服务器或操作系统提供的时间信息。

***检查注意事项***  
① 试验员应调查产品使用的时间信息、同步设置方法等。
- 不要求产品组件间时间同步的必须实现。

### 2.8.2 审计记录查询
#### 2.8.2.1 <font color="red">(必须)</font> 产品应提供授权管理员可查询审计记录的功能。
***要求项目***  
① 应只能通过产品提供的安全功能查询审计记录。  
② 产品应以适合授权管理员解释信息的方式提供审计记录。  
③ 审计记录中不应记录敏感数据(<u>密码、居民登记号等</u>)，但如记录不可避免，应以掩码处理后生成。

***检查注意事项***  
① 应确认是否阻止绕过产品提供的安全功能从外部直接查询审计记录的行为。  
- 如在产品内部DB中存储审计记录，产品应能控制对DB的访问权限。


#### 2.8.2.2 <font color="red">(必须)</font> 产品在查询审计记录时应提供管理员可选择逻辑条件、按多个条件搜索或排序的功能。
***检查注意事项***  
① 试验员应调查产品提供的审计记录查询时可设置的逻辑条件，考虑所有可能情况确认按条件的搜索及排序功能。

#### 2.8.2.3 <font color="orange">(条件必须)</font> 产品应实现使WAS日志不包含重要信息。
**条件:** WAS(Tomcat、JEUS等)包含在产品包中时

***要求项目***  
① 如产品内WAS(Tomcat、JEUS等)一起运营，应开发为不留自身日志，只在产品审计记录存储中留日志。  
② WAS日志中不应以明文留密码、密钥等重要信息。

### 2.8.3 审计记录保护
#### 2.8.3.1 <font color="red">(必须)</font> 产品应保护审计记录不被删除或变更。
***要求项目***  
① 应实现在本地存储中存储审计记录或实时传输到外部IT实体存储的功能。  
② 即使是授权管理员也不能删除及变更审计记录，不应提供相关用户界面(UI)及CLI命令。  
③ 为保护存储的审计记录，应能控制未授权者的访问。  
④ 如无法完全用产品安全功能实现，可支持在产品运营环境中保护审计记录存储。
  - 如审计记录存储在与产品相同操作系统上安装的DBMS中，可利用DBMS的识别及认证功能保护未授权用户的删除或变更。

⑤ 如审计记录存储在产品外部的日志服务器中，应执行加密通信。
  - 如支持syslog，应通过syslog over TLS (RFC 5424)、syslog over DTLS (RFC 6012)等支持加密传输。

***参考事项***  
① 如实时传输审计记录到外部IT实体存储，审计记录原件视为存储在外部实体中。

***检查注意事项***  
① 如审计记录存储在产品外部的日志服务器中，应确认是否执行加密通信。  
② 在本地存储中存储审计记录时适用，无论本地存储存储与否，如实时传输审计记录到外部实体存储，判定为满足。




#### 2.8.3.2 <font color="green">(选择)</font> 产品在内部存储审计记录时应加密存储。
***要求项目***  
① 使用的加密算法、密钥安全性及密钥存储方式应满足"9. 加密支持"要求。

### 2.8.4 审计记录丢失预测时响应行为
#### 2.8.4.1 <font color="red">(必须)</font> 产品在审计记录大小达到预定义容量时应执行响应行为。
***要求项目***  
① 应实现在本地存储中存储审计记录或实时传输到外部IT实体存储的功能。  
② 应必须提供通知管理员的功能，功能示例包括<u>屏幕告警、发送管理员电子邮件等</u>。  
③ 通知管理员的审计记录丢失响应相关条件示例包括设置的<u>磁盘容量90%以上、100MB以上等</u>。  
④ 附加可提供管理员将审计记录传输到外部日志服务器的功能。
  - 如支持syslog，应通过syslog over TLS (RFC 5424)、syslog over DTLS (RFC 6012)等支持加密传输。
  - 使用的加密算法、密钥安全性及密钥存储方式应满足"9. 加密支持"要求。

***检查注意事项***  
① 也可支持通知管理员的条件固定值。  
② 在本地存储中存储审计记录时适用，无论本地存储存储与否，如实时传输到外部IT实体存储，判定为"满足"。



### 2.8.5 审计记录丢失防止
#### 2.8.5.1 <font color="red">(必须)</font> 产品在审计记录存储容量饱和时应以适当方法应对存储失败。
***要求项目***  
① 应实现在本地存储中存储审计记录或实时传输到外部IT实体存储的功能。
② 存储失败响应功能示例包括<u>覆盖最旧审计记录、压缩存储审计记录等</u>。

***检查注意事项***  
① 在本地存储中存储审计记录时适用，无论本地存储存储与否，如实时传输到外部IT实体存储，判定为"满足"。


## 2.9 加密支持
产品数据存储传输时为保护使用的加密及哈希算法应满足国家公共机构要求的安全强度。此外使用加密的所有安全功能应满足"9. 加密支持"要求实现。

### 2.9.1 加密使用
#### 2.9.1.1 <font color="red">(必须)</font> 传输及存储重要信息时应使用推荐加密算法。
***要求项目***  
① 推荐加密算法为安全强度112bit以上的标准算法，参考[附表1]。示例如<表5>所示。
<table>
    <tr><th colspan="2">< 表5. 标准算法示例></th></tr>
    <tr><th>类别</th><th>示例</th></tr>
    <tr><td>哈希</td><td>SHA-224以上</td></tr>
    <tr><td>对称密钥加密</td><td>密钥长度128bit以上</td></tr>
    <tr><td>公钥加密</td><td>RSA 2048以上。DSA(2048, 224)以上</td></tr>
    <tr><td>电子签名</td><td>RSA-PSS 2048以上, KCDSA (2048, 224)以上, ECDSA/EC-KCDSA (B-233, B-283, K-223, P-224, P-256)</td></tr>
</table> 

② 但不允许使用TDES(含2 key、3 key)。  
③ 使用块加密时，如明文大小大于加密块大小，不应使用ECB模式。  
④ 使用块加密时，在CFB或OFB模式下不应使用固定Ⅳ。  
⑤ 应使用国内外标准加密算法，推荐使用国家用加密算法。  
⑥ 安全强度112 bit级以上加密算法的详细事项参考《加密算法及密钥长度使用指南》(科学技术信息通信部，2018)、《软件加密模块验证标准》、《NIST SP800-131 Ar2》。

***检查注意事项***  
① 应通过提交文件(《安全功能实现规范》或《安全功能运营说明》)确认产品在安全功能中适用的加密方式。  
② 密码应使用单向哈希算法或双向加密算法加密，即使重复输入相同明文，每次也应输出不同值。  
③ 试验员为试验按要求的准确实现，必要时可直接面对面开发者要求说明实现内容。

### 2.9.2 密钥生成
#### 2.9.2.1 <font color="red">(必须)</font> 产品应遵守以下要求项目生成密钥。
***要求项目***  
① 密钥生成方式示例包括基于密码的密钥派生(PKCS#5 v2.1(RFC 8018)、NIST SP 800-132等)、用预共享密钥派生密钥(TTAK.KO-2.0272)、使用随机数发生器生成密钥(CTR_DRBG、HASH_DRBG、HMAC_DRBG等)。  
② 随机数发生器应遵守国内外标准实现。  
③ 可使用随机数发生器生成的随机数生成非对称密钥对(公钥私钥)或对称密钥。  
④ 基于密码的密钥派生功能应只用于密钥加密密钥(KEK : Key Encryption Key)生成。
  - 最初的密钥加密密钥(KEK)应每个产品生成不同。
  - 密钥加密密钥(KEK)生成所需的初始数据(密码等)可直接输入或注入存储媒体如智能卡、安全USB、安全令牌(HSM : Hardware Security Module)等存储的值使用。
  - 推荐使用获得安全功能确认书或国内外CC证书产品的存储媒体。
  - 详细事项参考《加密密钥管理指南》(科学技术信息通信部，2018)加密密钥生成部分。
  - 如使用密码作为生成密钥加密密钥(KEK)的初始数据，可在产品首次安装时存储输入的值使用，存储的数据应受保护免受未授权暴露尝试。
⑤ salt值无需保密，使用随机数发生器生成，大小应至少128bit以上。  
⑥ iteration count应适用尽可能大的值。(至少1000次以上)

***检查注意事项***  
① 确认密码是否4位以上。  
② 试验员应调查产品提供的密钥生成方式(标准、随机数发生器等)。  
③ 如产品使用外部3rd Party Library或开源，应确认使用软件名称、版本信息。  
④ 如产品实现基于密码的密钥派生功能，应通过确认用户界面、调试试验等确认。



### 2.9.3 密钥存储
#### 2.9.3.1 <font color="red">(必须)</font> 产品应遵守以下要求项目存储密钥。
***要求项目***  
① 数据加密密钥(DEK)可使用加密密钥(KEK : Key Encryption Key)加密后存储。  
② 密钥加密密钥(KEK)可通过多阶段密钥链生成，其中最终密钥加密密钥(KEK)可使用上一阶段的密钥加密密钥(KEK)加密后存储。  
③ 密钥链中除最终密钥加密密钥(KEK)外的密钥加密密钥(KEK)不能存储。  
④ 如在产品外部存储密钥，推荐使用智能卡、安全USB、安全令牌(HSM)等安全性已确认的存储媒体。
  - 推荐使用获得安全功能确认书或国内外CC证书产品的存储媒体。

⑤ 不允许将密钥硬编码存储在产品中的方式。  
⑥ 申请厂商应如下<表6>所示识别产品存储及传输时使用的所有密钥，提交密钥存储及销毁方法的目录和说明资料证明安全性。  
⑦ 如产品存储用于产品管理的本地管理连接及与单独设备联动设置使用的密钥(预共享密钥、对称密钥、私钥等)，应以加密、访问控制等方式保护后存储。

<table align="center">
<tr><th colspan="2">< 表6. 密钥存储及销毁方法></th></tr>
<tr><th>密钥种类</th><th>密钥存储及销毁方法</th></tr>
<tr><td>TLS私钥</td><td>
    • 形态 : RSA Private Key<br />
    • 生成主体 : 在产品中生成<br />
    • 存储保护 : 产品内部存储存储区域阻止未授权者访问<br />
    • 销毁 : 执行密钥销毁命令时用0、1覆盖3次</td></tr>
<tr><td>TLS会话加密密钥</td><td>
    • 形态 : ARIA Key<br />
    • 生成主体 : 在产品中生成<br />
    • 存储保护 : 只存储在内存(RAM)中<br />
    • 销毁 : 会话结束时用0、1覆盖3次</td></tr>
<tr><td>TLS会话完整性检查密钥</td><td>
    • 形态 : HMAC Key<br />
    • 生成主体 : 在产品中生成<br />
    • 存储保护 : 只存储在内存(RAM)中<br />
    • 销毁 : 会话结束时用0、1覆盖3次</td></tr>
</table>

***参考事项***   
① 密钥指用于产品管理的本地连接管理连接及与单独设备联动设置使用的预共享密钥、对称密钥、私钥等所有密钥。

***检查注意事项***  
① 试验员应如上表所示调查产品使用的所有密钥，确认密钥存储及销毁方法。  
② 应确认产品的数据加密密钥是否全部加密后存储在内部。  
③ 应确认是否阻止未授权者访问产品内部的密钥存储区域。

### 2.9.4 密钥销毁
#### 2.9.4.1 <font color="red">(必须)</font> 产品应销毁产品生成或使用的密钥。
***要求项目***  
① △产品执行结束时 △调用密钥删除函数时 △加密通信结束时等情况应销毁使用期限届满的密钥及密钥相关信息。  
② 密钥销毁时可使用0或1的值覆盖3次以上的方式。  
③ 详细事项参考《加密密钥管理指南》(科学技术信息通信部，2018)加密密钥销毁方法。  

***检查注意事项***  
① 试验员应调查删除密钥及密钥相关信息的时期和销毁密钥的机制。  
② 应确认密钥销毁时是否删除加载(Load)到内存的密钥。


## 2.10 漏洞对应
产品应消除存在的已知漏洞。
### 2.10.1 源代码安全弱点消除
#### 2.10.1.1 <font color="green">(选择)</font> 产品开发时应适用安全编码规则以使源代码不存在安全弱点。
***要求项目***  
① 软件开发阶段应最小化安全弱点实现。  
② 可遵守以下标准指南。
  - 《ISO/IEC TS 17961:2013》、《JAVA 安全编码指南》(KISA)

③ 申请厂商应提交自行执行的产品安全弱点消除结果，证明安全性。  
④ 详细事项参考《软件开发安全指南》(行政安全部，2021.11)。

***检查注意事项***  
① 试验员应确认申请厂商提供的安全编码检查补完结果的适当性。  
② 应使用验证完毕产品目录中登载的源代码安全弱点诊断工具对产品执行独立安全弱点检查。  
③ 试验机构从申请厂商收到"漏洞改进保证誓约书"及"漏洞改进明细书"审查后，可省略漏洞试验。

### 2.10.2 已知漏洞消除
#### 2.10.2.1 <font color="red">(必须)</font> 应确认并消除产品内部的已知安全漏洞。
***要求项目***  
① 对于通过公开领域已知的安全漏洞(CVE、NVD论文等)，应确认并消除产品使用中的协议、库、开源等(OpenSSL、OpenSSH)是否存在相应安全漏洞。
  - 推荐产品包含的定制操作系统不使用低版本内核(LinuxⓇ 2.x)。

***检查注意事项***  
① 试验员应调查产品使用中的协议、库、开源等的名称及版本等。  
② 试验员应确认调查的3rd Party产品(Boot Loader、Busybox、OpenSSL、OpenSSH、Kernel等)是否存在漏洞及是否适用最新补丁，如未打补丁则判定为"不满足"。  
③ 试验员应基于调查的安全漏洞目录实施渗透试验，如确认可利用的漏洞则判定为"不满足"。  
④ 试验机构应确认漏洞检查工具使用的适当性并用于试验。



### 2.10.3 不必要服务消除
#### 2.10.3.1 <font color="red">(必须)</font> 如产品内部不必要服务正在执行，应确认并消除。
***要求项目***  
① 申请厂商应识别产品提供的服务并证明必要性。
② 应识别产品安全功能运行所需的必要服务和不必要服务，消除或停用不必要服务。

***检查注意事项***  
① 试验机构从申请厂商收到《安全功能实现规范》或《安全功能运营规范》，确认必要不必要服务的识别及不必要服务消除后可判定为"满足"。


<table>
  <tr><th colspan="3">〈附表1〉 视频传输相关标准协议目录(示例)</th></tr>
  <tr><th>协议</th><th>操作形态</th><th>备注</th></tr>
  <tr><td>ONVIF</td><td>HTTPS/TCP<br>HTTP/TCP</td><td>
  - www.onvif.org<br>
  - IEC 60839-11-31:2016, IEC 62676-2-31:2019<br>
  - 基于SOAP的HTTP/XML消息协议<br>
  &nbsp;&nbsp;(IP摄像机视频相关信息Read/Write)<br>
  - 视频传输采用RTP/RTSP等标准</td></tr>
  <tr><td>RTP</td><td>RTP/TCP<br>RTP/UDP</td><td>- RFC 3550<br>- KS C IEC 62676-2-1:2013<br>- 实质的Video及Audio Data传输</td></tr>
  <tr><td>RTSP</td><td>RTSP/TCP<br>RTSP/UDP</td><td>- RFC 2326<br>- KS C IEC 62676-2-1:2013<br>- RTP流控制</td></tr>
  <tr><td>SRTP</td><td>SRTP/TCP<br>SRTP/UDP</td><td>- RFC 3711, 5763<br>- RTP协议的扩展版<br>- 加密传输各RTP包的数据</td></tr>
  <tr><td>RTSPS</td><td>RTP/RTSP/TLS</td><td>- RFC 7826<br>- 加密传输各RTSP包的数据</td></tr>
  <tr><td>HTTP Tunneling</td><td>RTP/RTSP/HTTP(S)/TCP</td><td>- 将RTP/RTSP数据置于HTTP Payload中传输</td></tr>
  <tr><td>Websocket</td><td>RTP/RTSP/HTTP(S)/TCP</td><td>- RFC 6455<br>- 在Websocket内传输RTP/RTSP数据</td></tr>
</table>




